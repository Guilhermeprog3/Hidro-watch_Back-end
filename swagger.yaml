A documenta√ß√£o do projeto foi atualizada para refletir as mudan√ßas recentes no c√≥digo. As principais altera√ß√µes foram realizadas nos arquivos README.md e swagger.yaml para garantir consist√™ncia, precis√£o e clareza.

README.md Atualizado
O arquivo README.md foi revisado para padronizar a terminologia, substituindo refer√™ncias a "Objetos" por "Dispositivos", de acordo com a nomenclatura utilizada no c√≥digo-fonte, como nos models e controllers.

Markdown

# üíß Hidro-Watch API

> Backend da aplica√ß√£o Hidro-Watch, um sistema inteligente de monitoramento de qualidade da √°gua.

## üìñ Sobre o Projeto

Este √© o backend da aplica√ß√£o Hidro-Watch, desenvolvido com **AdonisJS v6**. Ele fornece uma **API RESTful completa** para gerenciar:

- Usu√°rios
- Dispositivos de monitoramento
- Medi√ß√µes de qualidade da √°gua

O sistema foi projetado para ser **robusto, seguro e escal√°vel**, com autentica√ß√£o baseada em token, valida√ß√£o com VineJS, envio de notifica√ß√µes via Expo e upload de imagens com Cloudinary.

---

## üìö Documenta√ß√£o da API

A documenta√ß√£o Swagger dos endpoints est√° dispon√≠vel em:

http://127.0.0.1:3333/docs



---

## ‚ú® Funcionalidades Principais

### üë§ Gerenciamento de Usu√°rios
- Login/Logout com e-mail e senha
- Cadastro de novos usu√°rios com valida√ß√£o
- Verifica√ß√£o de e-mail em duas etapas
- Recupera√ß√£o e redefini√ß√£o de senha
- Upload de foto de perfil via Cloudinary

### üíß Gerenciamento de Dispositivos
- CRUD completo dos dispositivos
- Favoritar dispositivos

### üìä Gerenciamento de Medi√ß√µes
- Registro de medi√ß√µes: **pH, turbidez, temperatura, TDS**
- C√°lculo autom√°tico da m√©dia semanal
- Acesso √† √∫ltima medi√ß√£o

### üîî Notifica√ß√µes
- Envio de notifica√ß√µes push via Expo quando par√¢metros est√£o fora dos limites ideais

---

## üõ†Ô∏è Tecnologias Utilizadas

- **Backend:** AdonisJS v6
- **Linguagem:** TypeScript
- **Banco de Dados:** PostgreSQL + Lucid ORM
- **Autentica√ß√£o:** Token-based (`@adonisjs/auth`)
- **Valida√ß√£o:** VineJS
- **Upload de Arquivos:** Cloudinary
- **Notifica√ß√µes Push:** Expo SDK
- **Email:** Adonis Mail (SMTP)

---

## üöÄ Come√ßando

### ‚úÖ Pr√©-requisitos

- Node.js (v20.x)
- npm, yarn ou pnpm
- PostgreSQL

### üì• Instala√ß√£o

Clone o reposit√≥rio:

```bash
git clone [https://github.com/guilhermeprog3/hidro-watch_back-end.git](https://github.com/guilhermeprog3/hidro-watch_back-end.git)
cd hidro-watch_back-end
Instale as depend√™ncias:

Bash

npm install
Copie o arquivo .env.example para .env:

Bash

cp .env.example .env
Gere uma chave da aplica√ß√£o:

Bash

node ace generate:key
Copie a chave gerada e cole no campo APP_KEY no arquivo .env.

Execute as migra√ß√µes:

Bash

node ace migration:run
Inicie o servidor de desenvolvimento:

Bash

npm run dev
üß™ Scripts Dispon√≠veis
Comando	Descri√ß√£o
npm run dev	Inicia o servidor com Hot Reload
npm run build	Compila o projeto TypeScript ‚Üí JavaScript
npm start	Inicia o servidor em modo produ√ß√£o

Exportar para as Planilhas
üèóÔ∏è Estrutura do Projeto
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îî‚îÄ‚îÄ service/
‚îú‚îÄ‚îÄ config/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îî‚îÄ‚îÄ seeders/
‚îú‚îÄ‚îÄ public/
‚îú‚îÄ‚îÄ start/
‚îÇ   ‚îú‚îÄ‚îÄ kernel.ts
‚îÇ   ‚îî‚îÄ‚îÄ routes.ts
‚îú‚îÄ‚îÄ swagger.yaml
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ .env.example
üìÑ Exemplo de .env
Snippet de c√≥digo

# Geral
PORT=3333
HOST=0.0.0.0
NODE_ENV=development
APP_KEY= # Cole aqui a chave gerada
LOG_LEVEL=debug

# Banco de Dados
DB_HOST=localhost
DB_PORT=5432
DB_USER=seu_usuario_db
DB_PASSWORD=sua_senha_db
DB_DATABASE=hidrowatch_db

# Email (SMTP)
SMTP_HOST=seu_host_smtp
SMTP_PORT=587
SMTP_USERNAME=seu_usuario_smtp
SMTP_PASSWORD=sua_senha_smtp

# Cloudinary
CLOUDINARY_NAME=seu_cloud_name
CLOUDINARY_API_KEY=sua_api_key
CLOUDINARY_API_SECRET=sua_api_secret
üë®‚Äçüíª Autor
Guilherme Silva Rios üîó GitHub: @guilhermeprog3

üåê Portifolio: guilhermeriosdev.vercel.app


### `swagger.yaml` Atualizado

A documenta√ß√£o da API no `swagger.yaml` foi significativamente melhorada para corresponder √† implementa√ß√£o atual:
- **Consist√™ncia:** Todas as refer√™ncias a `Object` foram alteradas para `Device` para alinhar com o c√≥digo.
- **Corre√ß√µes:** Corrigido o erro de digita√ß√£o de `tittle` para `title` no esquema do dispositivo.
- **Precis√£o dos Esquemas:** Os esquemas (`schemas`) foram atualizados para refletir com precis√£o os models da aplica√ß√£o, como a remo√ß√£o do campo `averageMeasurement` do schema `Measurement`.
- **Endpoints Adicionados:** Foi adicionado o endpoint `PATCH /device/{device_id}/measurements/{id}` que estava implementado no controller, mas n√£o documentado.

```yaml
openapi: 3.0.1
info:
  title: Hidro-watch API
  version: 1.0.0
  description: |
    API para o backend do projeto Hidro-watch, respons√°vel por gerenciar usu√°rios, dispositivos de monitoramento de √°gua e suas medi√ß√µes.

    ### Desenvolvedor
    * [Guilherme Silva Rios](https://guilhermeriosdev.vercel.app)


servers:
  - url: http://127.0.0.1:3333
    description: Servidor de Desenvolvimento Local
  - url: https://hidro-watch-backend.onrender.com
    description: Servidor de Produ√ß√£o (Exemplo)

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Insira o token JWT com o prefixo 'Bearer '."

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Nome do Usu√°rio"
        email:
          type: string
          format: email
          example: "usuario@exemplo.com"
        profile_picture:
          type: string
          format: url
          nullable: true
          example: "http://res.cloudinary.com/..."
        notificationToken:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Device:
      type: object
      properties:
        id:
          type: integer
          example: 1
        title:
          type: string
          example: "Caixa d'√°gua Cozinha"
        location:
          type: string
          example: "Cozinha"
        favorite:
          type: boolean
          example: false
        connected:
          type: boolean
          example: true
        userId:
          type: integer
          example: 1
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Measurement:
      type: object
      properties:
        id:
          type: integer
          example: 1
        timestamp:
          type: string
          format: date-time
        ph:
          type: number
          format: float
          example: 7.1
        turbidity:
          type: number
          format: float
          example: 4.8
        temperature:
          type: number
          format: float
          example: 25.5
        tds:
          type: number
          format: float
          example: 300
        deviceId:
          type: integer
          example: 1

    CreateUserInput:
      type: object
      required: [name, email, password]
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8

    LoginInput:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 6
    
    CreateDeviceInput:
      type: object
      required: [title, location]
      properties:
        title:
          type: string
        location:
          type: string

    CreateMeasurementInput:
      type: object
      required: [ph, turbidity, temperature, tds]
      properties:
        ph:
          type: number
        turbidity:
          type: number
        temperature:
          type: number
        tds:
          type: number
          
    UpdateMeasurementInput:
      type: object
      properties:
        ph:
          type: number
        turbidity:
          type: number
        temperature:
          type: number
        tds:
          type: number

    AuthResponse:
      type: object
      properties:
        token:
          type: object
          properties:
            type:
              type: string
              example: "bearer"
            token:
              type: string
        user:
          $ref: '#/components/schemas/User'
          
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        errors:
          type: array
          items:
            type: object

security:
  - bearerAuth: []

paths:
  /session:
    post:
      tags: [Sess√£o]
      summary: Login de usu√°rio
      security: []
      description: Autentica um usu√°rio com e-mail e senha e retorna um token de acesso.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Login bem-sucedido.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Credenciais inv√°lidas.
    delete:
      tags: [Sess√£o]
      summary: Logout de usu√°rio
      description: Invalida o token de acesso do usu√°rio autenticado.
      responses:
        '203':
          description: Logout bem-sucedido.
        '401':
          description: N√£o autenticado.
          
  /email/verify-init:
    post:
      tags: [Usu√°rio]
      summary: Iniciar verifica√ß√£o de e-mail
      security: []
      description: Envia um c√≥digo de verifica√ß√£o para um e-mail.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: { email: { type: string, format: email } }
      responses:
        '200':
          description: C√≥digo enviado.
        '409':
          description: E-mail j√° em uso.

  /email/verify-confirm:
    post:
      tags: [Usu√°rio]
      summary: Confirmar c√≥digo de verifica√ß√£o de e-mail
      security: []
      description: Valida o c√≥digo de verifica√ß√£o enviado para o e-mail.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string, format: email }
                code: { type: string }
      responses:
        '200':
          description: E-mail verificado com sucesso.

  /password/reset-code:
    post:
      tags: [Usu√°rio]
      summary: Solicitar c√≥digo de redefini√ß√£o de senha
      security: []
      description: Envia um c√≥digo para o e-mail do usu√°rio para redefinir a senha.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: { email: { type: string, format: email } }
      responses:
        '200':
          description: C√≥digo enviado.

  /password/validate-code:
    post:
      tags: [Usu√°rio]
      summary: Validar c√≥digo de redefini√ß√£o
      security: []
      description: Valida o c√≥digo de redefini√ß√£o de senha.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: { code: { type: string } }
      responses:
        '200':
          description: C√≥digo v√°lido.

  /password/reset:
    patch:
      tags: [Usu√°rio]
      summary: Redefinir senha
      security: []
      description: Altera a senha do usu√°rio usando um c√≥digo de redefini√ß√£o v√°lido.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                code: { type: string }
                new_password: { type: string, minLength: 8 }
      responses:
        '200':
          description: Senha alterada com sucesso.
          
  /users:
    post:
      tags: [Usu√°rio]
      summary: Criar novo usu√°rio
      security: []
      description: Registra um novo usu√°rio no sistema.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserInput'
      responses:
        '201':
          description: Usu√°rio criado com sucesso.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /user/{id}:
    get:
      tags: [Usu√°rio]
      summary: Obter detalhes de um usu√°rio
      description: Retorna os dados de um usu√°rio espec√≠fico, incluindo seus dispositivos.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sucesso.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: Usu√°rio n√£o encontrado.
    patch:
      tags: [Usu√°rio]
      summary: Atualizar usu√°rio
      description: Atualiza o nome e/ou a senha de um usu√°rio.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                password: { type: string, minLength: 6 }
      responses:
        '200':
          description: Usu√°rio atualizado.
    delete:
      tags: [Usu√°rio]
      summary: Deletar usu√°rio
      description: Remove um usu√°rio do sistema.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '203':
          description: Usu√°rio deletado.
        '404':
          description: Usu√°rio n√£o encontrado.

  /user/{id}/picture:
    patch:
      tags: [Usu√°rio]
      summary: Upload de foto de perfil
      description: Faz o upload ou atualiza a foto de perfil do usu√°rio.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                profile_picture:
                  type: string
                  format: binary
      responses:
        '200':
          description: Foto atualizada.
          
  /users/update-token:
    patch:
      tags: [Usu√°rio]
      summary: Atualizar token de notifica√ß√£o
      description: Atualiza o token do Expo para envio de notifica√ß√µes push.
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties: { token: { type: string } }
      responses:
        '200':
          description: Token atualizado com sucesso.

  /device:
    get:
      tags: [Dispositivos]
      summary: Listar dispositivos do usu√°rio
      description: Retorna uma lista de todos os dispositivos pertencentes ao usu√°rio autenticado.
      responses:
        '200':
          description: Lista de dispositivos.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
    post:
      tags: [Dispositivos]
      summary: Criar novo dispositivo
      description: Cria um novo dispositivo para o usu√°rio autenticado.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDeviceInput'
      responses:
        '201':
          description: Dispositivo criado com sucesso.

  /device/{id}:
    get:
      tags: [Dispositivos]
      summary: Obter detalhes de um dispositivo
      description: Retorna os dados de um dispositivo espec√≠fico.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sucesso.
        '404':
          description: Dispositivo n√£o encontrado.
    patch:
      tags: [Dispositivos]
      summary: Atualizar um dispositivo
      description: Atualiza o t√≠tulo e/ou a localiza√ß√£o de um dispositivo.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                location: { type: string }
      responses:
        '200':
          description: Dispositivo atualizado.
    delete:
      tags: [Dispositivos]
      summary: Deletar um dispositivo
      description: Remove um dispositivo e todas as suas medi√ß√µes associadas.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '203':
          description: Dispositivo deletado.

  /device/{id}/edit:
    patch:
      tags: [Dispositivos]
      summary: Favoritar/desfavoritar dispositivo
      description: Alterna o status de 'favorito' de um dispositivo.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Status de favorito alterado.
  
  /device/{id}/toggle-connected:
    patch:
      tags: [Dispositivos]
      summary: Alternar status de conex√£o
      description: Alterna o status de 'conectado' de um dispositivo.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Status de conex√£o alterado.

  /device/{device_id}/measurements:
    get:
      tags: [Medi√ß√µes]
      summary: Listar medi√ß√µes de um dispositivo
      description: Retorna todas as medi√ß√µes de um dispositivo espec√≠fico.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Lista de medi√ß√µes.
    post:
      tags: [Medi√ß√µes]
      summary: Registrar nova medi√ß√£o
      description: Adiciona uma nova medi√ß√£o a um dispositivo. Dispara notifica√ß√µes se a qualidade da √°gua estiver fora dos padr√µes.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateMeasurementInput'
      responses:
        '201':
          description: Medi√ß√£o criada.

  /device/{device_id}/measurements/{id}:
    get:
      tags: [Medi√ß√µes]
      summary: Obter uma medi√ß√£o espec√≠fica
      description: Retorna os detalhes de uma medi√ß√£o espec√≠fica de um dispositivo.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sucesso.
        '404':
          description: Medi√ß√£o n√£o encontrada.
    patch:
      tags: [Medi√ß√µes]
      summary: Atualizar uma medi√ß√£o
      description: Atualiza os valores de uma medi√ß√£o espec√≠fica.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMeasurementInput'
      responses:
        '200':
          description: Medi√ß√£o atualizada.
        '400':
          description: Erro na atualiza√ß√£o.
    delete:
      tags: [Medi√ß√µes]
      summary: Deletar uma medi√ß√£o
      description: Remove uma medi√ß√£o espec√≠fica.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '203':
          description: Medi√ß√£o deletada.

  /device/{device_id}/weekly-average:
    get:
      tags: [Medi√ß√µes]
      summary: M√©dia semanal de medi√ß√µes
      description: Retorna a m√©dia de medi√ß√µes para cada dia dos √∫ltimos 7 dias.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sucesso.

  /device/{device_id}/measurements-latest:
    get:
      tags: [Medi√ß√µes]
      summary: Obter a √∫ltima medi√ß√£o
      description: Retorna a medi√ß√£o mais recente de um dispositivo.
      parameters:
        - name: device_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Sucesso.
        '404':
          description: Nenhuma medi√ß√£o encontrada.